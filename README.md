## 检查背包[超进度物品检测]（原名CheckBag）

## 介绍
作者: [hufang360](https://github.com/hufang360/TShockCheckBag)
修改：羽学  
更新日期:2024年12月10日 17:30  
插件版本:2.6.0  
本插件可通过修改【检查背包.json】配置文件来控制：  
检测频率、检测次数、封禁时间（封禁只封UUID，时间一过自动解封)  
并加入了常见的进度项,默认生成的配置文件完善了大部分进度物品身份证.  

## 关于默认生成的配置文件说明
```
由于陨石锭可以在地狱金箱子里能找到、Tshock的醉酒世界特性有骷髅王前会刷怪的BUG  
使得玩家老板前就可以获得：  
金钥匙、邪眼、村正、钴护盾、骨头、死灵套、骨鞭、陨石套等超进度物品  
并考虑到微光湖的存在将:【扩音器、邪眼、反诅咒咒语】设为【骷髅王进度】  
同时未把【新六矿近战系武器、锤斧类工具】加入到默认的配置文件中  
使用者可根据自己服务器情况自由修改配置文件调整合理的进度物品身份证明  
修改完配置文件后可使用【/reload】重载配置文件实时同步服务器  
```

## 指令
```
/cbag b，列出封禁记录  
/cbag i，列出违规物品  
/cbag d，ID表查重（除了《掉落免清》）
/reload
```

## 权限
```
cbag  
免检背包
```

## 授权示意：
```
以上指令权限名为 `cbag` 可分配给玩家使用：  
/group addperm default cbag

免检权限名【免检背包】，如需免检指定玩家可使用以下指令
1.新增一个item组，拥有【免检背包】权限
/group add item 免检背包

2.item组继承default所拥有的权限：
/group parent item default

3.将指定玩家分配到item组：
/user group 玩家名字 item
```

## 更新日志
```
2.6.0
移除了【设置成限制数量】配置项
加入了清理玩家身上物品配置项
加入了清理放入箱子的超进度物品逻辑
加入了扔出超进度物品就会消失的逻辑
以上对拥有【免检背包】权限的管理无效
应老外需求：根据怪物图鉴判断超进度物品
细分了克脑、世吞、机械三王、南瓜王、哀木、圣诞坦克、冰雪女王、双足翼龙、火星飞碟的超进度物品

2.5.0
优化代码，将预设配置改为内嵌文件
修复了即使击败BOSS也会清理当时期掉落物的BUG
加入了惩罚封禁表配置项，可自定义封禁：ip acc uuid

2.4.0
修复与自动存储插件一起时捡东西与装备饰品时卡顿问题
（v2.2.0开始产生的）

2.3.0
加入了新指令/cabg d 用于查ID表是否重复
[掉落数量]改名[限制数量]：
可设置超过此数量的所有玩家物品（可以选择是否清除）
该选项同时与[清掉落物]的"限制数量捡起值"共用
不受任何ID表限制，默认视为全物品ID

2.2.0
重构了部分方法，将ItemData换成了Dictionary字典键值
加入了【清掉落物】设定，超过指定数量内的所有物品/非进度内的物品无法捡起
加入了对广播、日志、封禁的配置开关,嫌清背包速度不够快的可以减少【检测间隔】
不建议动清理频率（对人多的服务器，高频检测是负担）

2.1.2
加入了清理所选物品
检查格子非空判定（修复不会清理物品问题）

2.1.1
修复了关服报错问题（卸载事件钩子写错了）

2.1.0
配置文件加入了个封禁缓存功能，
该功能基于恋恋修复5号包源码修改而来
移除了/cbag reload指令，重载只需要用tshock自带的/reload指令
测试发现：不开强制开荒清理物品功能会失效望周知

2.0.0 
经玩家反馈，检测背包的速度太慢特此更新：在配置文件加入了个【每秒更新频率】，数字越少检测速度越快
  
1.9.0
修复了日志会额外写一个.txt文件在服务器根目录的问题
【检查日志】记录换行间隔不再那么长

1.8.0
更新将违规信息写入【检查背包】文件夹里的【检查日志】
修改了默认生成的配置文件
【新一王后】→【肉后】：神灯烈焰
考虑tshock醉酒世界BUG骷髅王前掉骨头因素
【骷髅王后】→【世吞克脑后】：虚空保险库、虚空袋、闭合的虚空袋

1.7.0
全时期封禁加入：广播盒
优化了/cbag i的显示方式为：每行1个物品，每页15行，只显示当前进度会检测的物品
超进度物品警告方法从私聊玩家改为了发包给所有在线玩家

1.6.0
根据Dont dig up地图种子重调了默认配置文件以下物品进度项：
移除：魔法飞刀
骷髅王后进度：海蓝权杖、邪恶三叉戟、泡泡枪、金钥匙
世吞克脑后：陨石锭、星星炮、流星套、太空枪

1.5.0
加入了【免检背包】权限名，不再对【未登录】用户进行装备检查

1.4.0
将默认生成的配置里：抑郁球、血脉球从【世吞前】进度移除，
根据wiki把各种悠悠球产生时期明确排列了对应时期的进度锁。

1.3.0
去除所有重复的.json文件内的超进度物品ID。

1.2.0：
修复服主超管免检权，将config配置文件补充完整的进度ID

1.1.0
完善了checkbag插件的配置文件，
将原有的/checkbag指令与权限重新缩短为：/cbag
将watcher插件的清理违禁物品方式加入到了【检查背包】插件中
配置加入了【哥布林前】、【克眼】、【猪鲨】等更多进度限制
```

## 配置文件
位于`/tshock/检查背包/检查背包.json`,若不存在则会自动创建。  

```json  
{
  "物品查询": "https://terraria.wiki.gg/zh/wiki/Item_IDs",
  "配置说明": "指令/cbag（权限: cbag 和 免检背包）",
  "配置说明2": "[检查次数] 影响清理《超进度物品》与 [是否封禁]达标次数",
  "配置说明3": "[清掉落物]除了《全时期》其他任何表都会受影响，再也不用捡垃圾了（泪目）",
  "配置说明4": "[限制数量] 可限制玩家丢出的此数值任何物品无法捡起，可强制修改超过此数值的所有玩家物品; ",
  "配置说明5": "《掉落免清》可无视捡起，阻止不了[清超数量]与[超进度]",
  "检查开关": true,
  "检测间隔秒数": 5,
  "更新频率": 60,
  "检查次数": 150000,
  "是否封禁(↑调次数)": false,
  "惩罚封禁表": [
    {
      "封禁秒数": 600,
      "封禁IP": false,
      "封禁账号": true,
      "封禁设备": false
    }
  ],
  "超进度是否广播": true,
  "超进度记录日志": true,
  "限制数量": 500,
  "设置成限制数量": false,
  "清理超数量物品": false,
  "清掉落物": true,
  "无法捡起": true,
  "无法捡起半径": 10,
  "清理箱子": true,
  "清掉落与箱子物品表": {
    "3617": 1,
    "4956": 1
  },
  "免清表": [
    8
  ],
  "全时期": {
    "3617": 1
  },
  "哥布林入侵": {
    "128": 1,
    "395": 1,
  }
  …
}
```
<br>
